@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
    Layout = "_LayoutEmpty";
}
<!DOCTYPE html>
<html>
<head>
    <style>
        /* Validation text CSS */
        .validation-text {
            visibility: hidden;
            color: crimson;
            margin-top: 10px;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif
        }

        /* Loading spinner CSS */
        #loadingSpinner {
            visibility: hidden;
            width: 24;
            height: 24
        }

    </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body class="bg-gray-200">
    <main class="main-content  mt-0">
        <div class="page-header align-items-start min-vh-100" style="background-image: url('https://images.unsplash.com/photo-1497294815431-9365093b7331?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1950&q=80');">
            <span class="mask bg-gradient-dark opacity-6"></span>
            <div class="container my-auto">
                <div class="row">
                    <div class="col-lg-4 col-md-8 col-12 mx-auto">
                        <div class="card z-index-0 fadeIn3 fadeInBottom">
                            <div class="card-header p-0 position-relative mt-n4 mx-3 z-index-2">
                                <div class="bg-gradient-primary shadow-primary border-radius-lg py-3 pe-1">
                                    <h4 class="text-white font-weight-bolder text-center mt-2 mb-0">Sign in</h4>
                                    @* <div class="row mt-3">
                    <div class="col-2 text-center ms-auto">
                      <a class="btn btn-link px-3" href="javascript:;">
                        <i class="fa fa-facebook text-white text-lg"></i>
                      </a>
                    </div>
                    <div class="col-2 text-center px-1">
                      <a class="btn btn-link px-3" href="javascript:;">
                        <i class="fa fa-github text-white text-lg"></i>
                      </a>
                    </div>
                    <div class="col-2 text-center me-auto">
                      <a class="btn btn-link px-3" href="javascript:;">
                        <i class="fa fa-google text-white text-lg"></i>
                      </a>
                    </div>
                  </div> *@
                                </div>
                            </div>
                            <div class="card-body" style="height:350px">
                                <form role="form" class="text-start" method="post">
                                    @* <input name="__RequestVerificationToken" type="hidden" value="@Html.AntiForgeryToken()" /> *@
                                    <div class="input-group input-group-outline my-3">
                                        <label class="form-label">Username</label>
                                        <input id="UserName" type="text" class="form-control" value="@ViewData["UserName"]" required>
                                    </div>
                                    <div class="input-group input-group-outline mb-3">
                                        <label class="form-label">Password</label>
                                        <input id="Password" type="password" class="form-control" value="@ViewData["Password"]" required>
                                        <span class="input-group-text" style="padding-left: 10px; padding-right: 10px;" onclick="togglePasswordVisibility()">
                                            <i id="password-icon" class="fa fa-eye"></i>
                                        </span>
                                    </div>
                                    <div class="text-center">
                                        <button type="button" href="javascript:void(0);" class="btn bg-gradient-primary w-100 my-4 mb-2" onclick="LogUser();">Sign in</button>
                                    </div>
                                    <div class="text-center">
                                        <div id="loadingSpinner">
                                            <img src="/assets/img/spinn.gif" alt="Loading..." width="24" height="24">
                                        </div>
                                        <div class="validation-text" id="validationText"></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer position-absolute bottom-2 py-2 w-100">
                <div class="container">
                    <div class="row align-items-center justify-content-lg-between">
                        <div class="col-12 col-md-6 my-auto">
                            <div class="copyright text-center text-sm text-white text-lg-start">
                                © <script>
                                      document.write(new Date().getFullYear())
                                </script>
                                <a href="/Index" class="font-weight-bold text-white" target="_blank">KAM Global</a>
                            </div>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </main>
    <script>
        var win = navigator.platform.indexOf('Win') > -1;
        if (win && document.querySelector('#sidenav-scrollbar')) {
          var options = {
            damping: '0.5'
          }
          Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
        }
    </script>

    <script type="text/javascript">


        function togglePasswordVisibility() {
            var passwordField = document.getElementById("Password");
            var passwordIcon = document.getElementById("password-icon");
            if (passwordField.type === "password") {
                passwordField.type = "text";
                passwordIcon.classList.remove("fa-eye");
                passwordIcon.classList.add("fa-eye-slash");
            } else {
                passwordField.type = "password";
                passwordIcon.classList.remove("fa-eye-slash");
                passwordIcon.classList.add("fa-eye");
            }
        }

        function LogUser() {
            // Hide loading spinner & validation text
            document.getElementById("loadingSpinner").style.visibility = "hidden";
            //document.getElementById("validationText").innerText = "Enter Your Credentials";
            document.getElementById("validationText").style.visibility = "hidden";

            // Getting username & password from input fields
            var UserName = document.getElementById("UserName").value;
            var Password = document.getElementById("Password").value;

            // Check if username or password is empty
            if (!UserName || !Password) {
                document.getElementById("loadingSpinner").style.visibility = "hidden";
                document.getElementById("validationText").innerText = "Empty Username and/or Password";
                document.getElementById("validationText").style.visibility = "visible";
                return;
            }
            document.getElementById("loadingSpinner").style.visibility = "visible";
            document.getElementById("validationText").innerText = "Signing you in...";
            document.getElementById("validationText").style.visibility = "visible";

            //var token = $('input[name="__RequestVerificationToken"]').val();

            // Creating an object to hold user credentials
            var userData =
            {
                UserName: UserName,
                Password: Password
            };

            // Make AJAX call to server to log in user
            $.ajax({
                type: "POST",
                url: "/Index?handler=LoginUser",
                headers: {
                    "RequestVerificationToken": $('input:hidden[name="__RequestVerificationToken"]').val()
                    //"RequestVerificationToken": token
                },
                data: userData,
                async: true
            }).done(function (data) {
                document.getElementById("loadingSpinner").style.visibility = "hidden";
                document.getElementById("validationText").innerText = data.message;
                document.getElementById("validationText").style.visibility = "visible";

                // Handle success
                if (data.success) {
                    window.location.href = data.redirectUrl;
                } else {
                    document.getElementById("loadingSpinner").style.visibility = "hidden";
                    document.getElementById("validationText").innerText = data.message;
                    document.getElementById("validationText").style.visibility = "visible";
                }
            }).fail(function (jqXHR, textStatus, errorThrown) {
                // Handle failure
                console.log("Fail: " + textStatus + " - " + errorThrown);
                document.getElementById("loadingSpinner").style.visibility = "hidden";
                document.getElementById("validationText").innerText = "FAIL";
                document.getElementById("validationText").style.visibility = "visible";
            });

        }
    </script>
</body>
</html>
